type Locale = 'zh' | 'en'

const dictionaries: Record<Locale, Record<string, string>> = {
  zh: {
    'nav.home': '主页',
    'nav.projects': '项目',
    'nav.myAccount': '我的账号',
    'nav.profile': '个人信息',
    'nav.themeLight': '浅色模式',
    'nav.themeDark': '深色模式',
    'nav.language': '语言',
    'nav.logout': '退出登录',
    'projects.myProjects': '我的项目',
    'projects.goToProjects': '前往项目页',
    'projects.loadProject': '加载项目',
    'projects.loading': '加载中...',
    'projects.empty': '暂无项目',
    'sidebar.explorer': '资源管理器',
    'sidebar.searchTables': '搜索数据表...',
    'sidebar.connections': '连接',
    'sidebar.databases': '数据库',
    'sidebar.admin': '管理员',
    'sidebar.systemInfo': '系统信息',
    'sidebar.tables': '数据表',
    'sidebar.added': '已添加',
    'sidebar.unadded': '未添加',
    'sidebar.connectToSeeTables': '连接数据库后查看数据表',
    'canvas.versions': '版本',
    'canvas.save': '保存',
    'canvas.zoomFit': '适配屏幕',
    'canvas.zoomOut': '缩小',
    'canvas.zoomIn': '放大',
    'canvas.reload': '刷新',
    'canvas.organize': '整理节点',
    'canvas.clear': '清空',
    'canvas.exportSql': '导出 SQL',
    'canvas.toggleSidebar': '切换侧边栏',
    'canvas.undo': '撤销',
    'canvas.redo': '重做',
    'canvas.handMode': '手形模式',
    'canvas.pointerMode': '指针模式',
    'canvas.context.deleteConnection': '删除连线',
    'canvas.context.deleteNode': '删除节点',
    'canvas.context.deleteSelectedNodes': '删除选中节点',
    'canvas.context.deleteSelection': '删除选中项',
    'canvas.context.addNote': '添加注释',
    'canvas.context.connect': '连接',
    'canvas.context.hideColumn': '隐藏字段',
    'canvas.context.showColumn': '显示字段',
    'canvas.connectionMenu.test': '测试连接',
    'canvas.connectionMenu.edit': '编辑连接',
    'common.close': '关闭',
    'common.copy': '复制',
    'common.saveChanges': '保存更改',
    'toast.info': '提示',
    'toast.tableAlreadyOnCanvas': '该数据表已在画布中',
    'toast.loadProjectFailed': '加载项目失败',
    'toast.sqlCopied': '已复制 SQL 到剪贴板',
    'toast.noProjectSelected': '未选择项目',
    'toast.versionSaved': '版本保存成功',
    'toast.saveVersionFailed': '保存版本失败',
    'toast.loadVersionsFailed': '加载版本失败',
    'toast.restoreVersionFailed': '恢复版本失败',
    'toast.profileUpdated': '个人信息已更新',
    'toast.profileUpdateFailed': '更新个人信息失败',
    'toast.selectTargetTitle': '选择目标',
    'toast.selectTargetDesc': '选择一个字段连接到 {target}',
    'toast.connectSameTableDenied': '不能连接同一张表的字段',
    'toast.connected': '已连接',
    'toast.testingConnection': '正在测试连接...',
    'toast.connectionTestFailed': '连接测试失败',
    'toast.connectionUpdated': '连接已更新',
    'toast.connectionSaved': '连接已保存',
    'toast.saveConnectionFailed': '保存连接失败',
    'toast.databaseConnected': '数据库已连接',
    'toast.error': '错误',
    'saveProject.title': '保存项目',
    'saveProject.description': '给你的数据库图命名。',
    'saveProject.field.name': '名称',
    'saveProject.action.save': '保存',
    'sqlExport.title': '导出 SQL',
    'sqlExport.description': '当前图的 DDL 语句。',
    'userSettings.title': '用户设置',
    'userSettings.description': '更新你的个人信息。',
    'userSettings.field.name': '名称',
    'userSettings.field.avatarUrl': '头像 URL',
    'userSettings.action.save': '保存修改',
    'note.title': '注释',
    'note.placeholder': '写点什么...',
    'table.primaryKey': '主键',
    'table.foreignKey': '外键',
    'table.hiddenColumns': '隐藏字段',
    'table.hiddenColumnsTitle': '隐藏字段',
    'draft.restoreConfirm': '确定回滚到该版本吗？回滚后的修改会进入临时草稿，退出时可选择保存。',
    'draft.restored': '已回滚到版本（临时草稿）',
    'draft.exitTitle': '临时草稿未保存',
    'draft.exitDescription': '你在临时草稿中有未保存的修改，是否保存后再离开？',
    'draft.saveAndExit': '保存并离开',
    'draft.discardAndExit': '不保存直接离开',
    'draft.cancel': '取消',
    'connectionDialog.addTitle': '添加连接',
    'connectionDialog.editTitle': '编辑连接',
    'connectionDialog.addDescription': '输入你的数据库连接信息。',
    'connectionDialog.editDescription': '修改你的数据库连接信息。',
    'connectionDialog.field.name': '名称',
    'connectionDialog.field.type': '类型',
    'connectionDialog.field.host': '主机',
    'connectionDialog.field.port': '端口',
    'connectionDialog.field.user': '用户',
    'connectionDialog.field.password': '密码',
    'connectionDialog.field.database': '数据库',
    'connectionDialog.placeholder.name': '我的数据库',
    'connectionDialog.placeholder.type': '选择类型',
    'connectionDialog.placeholder.passwordUnchanged': '不修改',
    'connectionDialog.action.save': '保存',
    'connectionDialog.action.update': '更新',
  },
  en: {
    'nav.home': 'Home',
    'nav.projects': 'Projects',
    'nav.myAccount': 'My Account',
    'nav.profile': 'Profile',
    'nav.themeLight': 'Light Mode',
    'nav.themeDark': 'Dark Mode',
    'nav.language': 'Language',
    'nav.logout': 'Log out',
    'projects.myProjects': 'My Projects',
    'projects.goToProjects': 'Go to Projects Page',
    'projects.loadProject': 'Load Project',
    'projects.loading': 'Loading...',
    'projects.empty': 'No projects',
    'sidebar.explorer': 'Explorer',
    'sidebar.searchTables': 'Search tables...',
    'sidebar.connections': 'Connections',
    'sidebar.databases': 'Databases',
    'sidebar.admin': 'Admin',
    'sidebar.systemInfo': 'System Info',
    'sidebar.tables': 'Tables',
    'sidebar.added': 'Added',
    'sidebar.unadded': 'Unadded',
    'sidebar.connectToSeeTables': 'Connect to a database to see tables',
    'canvas.versions': 'Versions',
    'canvas.save': 'Save',
    'canvas.zoomFit': 'Fit diagram to screen',
    'canvas.zoomOut': 'Zoom out',
    'canvas.zoomIn': 'Zoom in',
    'canvas.reload': 'Reload',
    'canvas.organize': 'Organize Nodes',
    'canvas.clear': 'Clear',
    'canvas.exportSql': 'Export SQL',
    'canvas.toggleSidebar': 'Toggle Sidebar',
    'canvas.undo': 'Undo',
    'canvas.redo': 'Redo',
    'canvas.handMode': 'Hand Mode',
    'canvas.pointerMode': 'Pointer Mode',
    'canvas.context.deleteConnection': 'Delete Connection',
    'canvas.context.deleteNode': 'Delete Node',
    'canvas.context.deleteSelectedNodes': 'Delete Selected Nodes',
    'canvas.context.deleteSelection': 'Delete Selection',
    'canvas.context.addNote': 'Add Note',
    'canvas.context.connect': 'Connect',
    'canvas.context.hideColumn': 'Hide Column',
    'canvas.context.showColumn': 'Show Column',
    'canvas.connectionMenu.test': 'Test Connection',
    'canvas.connectionMenu.edit': 'Edit Connection',
    'common.close': 'Close',
    'common.copy': 'Copy',
    'common.saveChanges': 'Save changes',
    'toast.info': 'Info',
    'toast.tableAlreadyOnCanvas': 'Table already on canvas',
    'toast.loadProjectFailed': 'Failed to load project data',
    'toast.sqlCopied': 'SQL copied to clipboard',
    'toast.noProjectSelected': 'No project selected',
    'toast.versionSaved': 'Version saved successfully',
    'toast.saveVersionFailed': 'Failed to save version',
    'toast.loadVersionsFailed': 'Failed to load versions',
    'toast.restoreVersionFailed': 'Failed to restore version',
    'toast.profileUpdated': 'Profile updated',
    'toast.profileUpdateFailed': 'Failed to update profile',
    'toast.selectTargetTitle': 'Select Target',
    'toast.selectTargetDesc': 'Select a column to connect to {target}',
    'toast.connectSameTableDenied': 'Cannot connect columns within the same table',
    'toast.connected': 'Connected',
    'toast.testingConnection': 'Testing connection...',
    'toast.connectionTestFailed': 'Connection Test Failed',
    'toast.connectionUpdated': 'Connection updated',
    'toast.connectionSaved': 'Connection saved',
    'toast.saveConnectionFailed': 'Failed to save connection',
    'toast.databaseConnected': 'Database connected',
    'toast.error': 'Error',
    'saveProject.title': 'Save Project',
    'saveProject.description': 'Give your database diagram a name.',
    'saveProject.field.name': 'Name',
    'saveProject.action.save': 'Save',
    'sqlExport.title': 'Export SQL',
    'sqlExport.description': 'Generated DDL statements for the current diagram.',
    'userSettings.title': 'User Settings',
    'userSettings.description': 'Update your profile information.',
    'userSettings.field.name': 'Name',
    'userSettings.field.avatarUrl': 'Avatar URL',
    'userSettings.action.save': 'Save Changes',
    'note.title': 'Note',
    'note.placeholder': 'Write something...',
    'table.primaryKey': 'Primary Key',
    'table.foreignKey': 'Foreign Key',
    'table.hiddenColumns': 'hidden columns',
    'table.hiddenColumnsTitle': 'Hidden Columns',
    'draft.restoreConfirm': 'Restore this version? Changes will be in a temporary draft until you save.',
    'draft.restored': 'Version restored (temporary draft)',
    'draft.exitTitle': 'Unsaved draft changes',
    'draft.exitDescription': 'You have unsaved changes in a temporary draft. Save before leaving?',
    'draft.saveAndExit': 'Save and leave',
    'draft.discardAndExit': 'Discard and leave',
    'draft.cancel': 'Cancel',
    'connectionDialog.addTitle': 'Add Connection',
    'connectionDialog.editTitle': 'Edit Connection',
    'connectionDialog.addDescription': 'Enter the details to connect to your database.',
    'connectionDialog.editDescription': 'Modify your database connection details.',
    'connectionDialog.field.name': 'Name',
    'connectionDialog.field.type': 'Type',
    'connectionDialog.field.host': 'Host',
    'connectionDialog.field.port': 'Port',
    'connectionDialog.field.user': 'User',
    'connectionDialog.field.password': 'Password',
    'connectionDialog.field.database': 'Database',
    'connectionDialog.placeholder.name': 'My DB',
    'connectionDialog.placeholder.type': 'Select type',
    'connectionDialog.placeholder.passwordUnchanged': 'Unchanged',
    'connectionDialog.action.save': 'Save',
    'connectionDialog.action.update': 'Update',
  },
}

export const useI18n = () => {
  const locale = useState<Locale>('db-pivot-locale', () => 'zh')

  if (import.meta.client) {
    const stored = localStorage.getItem('db-pivot-locale') as Locale | null
    if (stored === 'zh' || stored === 'en') {
      locale.value = stored
    }
  }

  const setLocale = (next: Locale) => {
    locale.value = next
    if (import.meta.client) {
      localStorage.setItem('db-pivot-locale', next)
    }
  }

  const toggleLocale = () => {
    setLocale(locale.value === 'zh' ? 'en' : 'zh')
  }

  const t = (key: string, params?: Record<string, string | number>) => {
    const template = dictionaries[locale.value]?.[key] ?? dictionaries.en[key] ?? key
    if (!params) return template
    return template.replace(/\{(\w+)\}/g, (_, name) => String(params[name] ?? `{${name}}`))
  }

  return {
    locale,
    setLocale,
    toggleLocale,
    t,
  }
}
